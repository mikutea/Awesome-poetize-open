server:
  port: 8081
  tomcat:
    # 启用虚拟线程支持
    use-virtual-threads: true
    # 调整为虚拟线程优化的配置
    max-connections: 500
    max-http-form-post-size: 120MB
    connection-timeout: 60000

# 预渲染配置
prerender:
  startup:
    # 是否在应用启动时自动执行预渲染
    enabled: true
    # 启动后延迟多少秒开始预渲染（确保应用完全启动）
    delay: 10
    # 健康检查配置
    health-check:
      # 最大重试次数
      max-retries: 5
      # 基础延迟时间（秒），第1次失败等待60秒，第2次等待180秒，第3次等待300秒...
      base-delay: 60

mybatis-plus:
  mapper-locations: classpath*:mapper/**/*.xml
#  configuration:
#    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-value: 1
      logic-not-delete-value: 0

spring:
  # Java 21 虚拟线程配置
  threads:
    virtual:
      enabled: true
  # 异步任务执行器也使用虚拟线程
  task:
    execution:
      pool:
        virtual-threads: true
    scheduling:
      pool:
        virtual-threads: true
  
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB

  mail:
    # 以下配置已注释，将从系统配置表动态获取
    # host:
    # username: 
    # password:
    default-encoding: utf-8
    protocol: smtp
    # port: 465
    properties:
      mail:
        smtp:
          # auth: true
          starttls:
            enable: true
            required: true
          socketFactory:
            # port: 465
            class: jakarta.net.ssl.SSLSocketFactory
            fallback: false
          # ssl:
            # enable: true

  datasource:
    username: root
    password: 123456
    url: jdbc:mariadb://localhost:3306/poetize?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: org.mariadb.jdbc.Driver
    
    # Druid 连接池配置
    druid:
      # 连接池大小配置
      initial-size: ${SPRING_DATASOURCE_DRUID_INITIAL_SIZE:5}
      min-idle: ${SPRING_DATASOURCE_DRUID_MIN_IDLE:5}
      max-active: ${SPRING_DATASOURCE_DRUID_MAX_ACTIVE:50}
      
      # 防止连接泄露、
      remove-abandoned: true
      remove-abandoned-timeout: 180
      
      # 连接健康检测
      test-while-idle: true
      validation-query: SELECT 1

  # Redis配置
  redis:
    host: ${SPRING_REDIS_HOST:localhost}
    port: ${SPRING_REDIS_PORT:6379}
    # 如果Redis没有设置密码，则留空或注释掉password配置
    password: ${SPRING_REDIS_PASSWORD:123456}
    database: ${SPRING_REDIS_DATABASE:0}
    timeout: ${SPRING_REDIS_TIMEOUT:5000}ms
    lettuce:
      pool:
        max-active: ${SPRING_REDIS_LETTUCE_POOL_MAX_ACTIVE:20}
        max-idle: ${SPRING_REDIS_LETTUCE_POOL_MAX_IDLE:10}
        min-idle: ${SPRING_REDIS_LETTUCE_POOL_MIN_IDLE:5}
        max-wait: -1ms
      shutdown-timeout: 100ms
    connect-timeout: 5000ms

  # 缓存配置
  cache:
    type: redis
    redis:
      time-to-live: 604800000  # 默认7天过期，与TOKEN_EXPIRE保持一致（604800秒 * 1000毫秒）
      cache-null-values: false
      use-key-prefix: true
      key-prefix: "poetize:"

user:
  code:
    format:
  subscribe:
    format:

store:
  type:

local:
  enable:
  uploadUrl:
  downloadUrl:

qiniu:
  enable:
  accessKey:
  secretKey:
  bucket:
  downloadUrl:

# 兰空图床配置
lsky:
  enable:
  url:
  token:
  strategy_id:

# 简单图床配置  
easyimage:
  enable:
  url:
  token:

python:
  server:
    url: ${PYTHON_SERVICE_URL:http://localhost:5000}
  service:
    url: ${PYTHON_SERVICE_URL:http://localhost:5000}  # 添加此配置，与TranslationService中的@Value注解对应

# 翻译API配置
translation:
  api:
    url: https://api.fanyi.baidu.com/api/trans/vip/translate
    key: your-api-id:your-api-key
    cache-time-hours: 24
  local:
    enabled: false
    url: ${PYTHON_SERVICE_URL}/api/translate

# Actuator配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
  health:
    defaults:
      enabled: true
  info:
    build:
      enabled: true
    env:
      enabled: true

# 在现有配置中添加图片压缩配置
image:
  compress:
    # 默认压缩配置
    default:
      max-width: 2560
      max-height: 1440
      quality: 0.9
      target-size: 1024000  # 1000KB
    # 缩略图配置
    thumbnail:
      max-width: 300
      max-height: 300
      quality: 0.7
      target-size: 102400  # 100KB
    # 头像配置
    avatar:
      max-width: 300
      max-height: 300
      quality: 0.8
      target-size: 128000  # 128KB
    # 压缩质量阈值（低于此质量不再压缩）
    min-quality: 0.3
    # 文件大小阈值（小于此大小不压缩）
    size-threshold: 204800  # 200KB

# ================================
# 密码安全配置 - Password Security Configuration
# ================================
# 本配置段用于管理系统的密码安全策略
# 根据部署场景选择合适的安全策略，每种策略都有明确的适用范围
poetize:
  security:
    password:
      # ========== 部署场景选择 ==========
      # 选择适合您系统的部署场景，系统会自动应用对应的安全策略
      # 可选值：
      #   new-system     - 全新系统：最高安全级别，仅支持BCrypt（推荐）
      #   existing-system - 现有系统：兼容MD5，自动升级到BCrypt
      #   migration-system - 迁移系统：有时间限制的MD5支持，逐步迁移
      deployment-scenario: new-system

      # ========== BCrypt加密配置 ==========
      # BCrypt强度级别（4-31）
      # 推荐值：10-12（平衡安全性和性能）
      # 注意：强度越高，加密时间越长，但安全性越好
      bcrypt-strength: 12

      # ========== 迁移配置（仅在migration-system模式下需要） ==========
      # 迁移系统的MD5支持截止时间，格式：yyyy-MM-dd HH:mm:ss
      # 示例：migration-end-time: "2025-12-31 23:59:59"
      # migration-end-time: null

