<template>
  <div>
    <div class="friend-wrap">
      <div class="friend-main">
        <h2 style="font-size: 24px;">ğŸŒŸé’å‡ºäºè“</h2>
        <card :resourcePathList="eliteFriends" @clickResourcePath="clickFriend"></card>

        <hr>

        <h2 style="font-size: 24px; margin-top: 60px">ğŸ¥‡å‹æƒ…é“¾æ¥</h2>
        <card :resourcePathList="regularFriends" @clickResourcePath="clickFriend"></card>

        <hr>

        <div style="font-size: 24px;font-weight: bold;margin-top: 60px">âœ‰ï¸ ç”³è¯·æ–¹å¼</div>
        <div class="application-guide">
          <div class="guide-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <p class="step-title">æ·»åŠ æœ¬ç«™é“¾æ¥</p>
              <p class="step-desc">é¦–å…ˆå°†æœ¬ç«™é“¾æ¥æ·»åŠ è‡³æ‚¨çš„ç½‘ç«™ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p>
            </div>
          </div>
          
          <div class="site-info-box">
            <div class="info-item">
              <span class="info-label">ç½‘ç«™åç§°</span>
              <span class="info-value">{{siteInfo.title || $constant.friendWebName}}</span>
            </div>
            <div class="info-item">
              <span class="info-label">ç½‘ç«™åœ°å€</span>
              <span class="info-value">{{siteInfo.url || $constant.friendUrl}}</span>
            </div>
            <div class="info-item">
              <span class="info-label">ç½‘ç«™æè¿°</span>
              <span class="info-value">{{siteInfo.introduction || $constant.friendIntroduction}}</span>
            </div>
            <div class="info-item">
              <span class="info-label">ç½‘ç«™å°é¢</span>
              <span class="info-value">{{siteInfo.cover || $constant.friendCover}}</span>
            </div>
          </div>

          <div class="guide-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <p class="step-title">æäº¤ç”³è¯·</p>
              <p class="step-desc">ç‚¹å‡»ä¸‹æ–¹ä¿¡å° ğŸ“® å¡«å†™æ‚¨çš„ç½‘ç«™ä¿¡æ¯æäº¤ç”³è¯·</p>
            </div>
          </div>

          <div class="guide-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <p class="step-title">ç­‰å¾…å®¡æ ¸</p>
              <p class="step-desc">å®¡æ ¸é€šè¿‡åå°†ä¼šæ·»åŠ è‡³è¯¥é¡µé¢ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…</p>
            </div>
          </div>
        </div>
        
        <div style="font-size: 24px;font-weight: bold;margin-top: 30px">âš ï¸ æ¸©é¦¨æç¤º</div>
        <div class="notice-box">
          <ul class="notice-list">
            <li>ä¸ä¼šæ·»åŠ å¸¦æœ‰å¹¿å‘Šè¥é”€å’Œæ²¡æœ‰å®è´¨æ€§å†…å®¹çš„å‹é“¾</li>
            <li>ç”³è¯·ä¹‹å‰è¯·å°†æœ¬ç½‘ç«™æ·»åŠ ä¸ºæ‚¨çš„å‹é“¾</li>
            <li>å®¡æ ¸æ—¶é—´ä¸€èˆ¬åœ¨ä¸€å‘¨å†…ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
          </ul>
        </div>

        <!-- æ·»åŠ å‹é“¾ -->
        <div @click="clickLetter()" class="form-wrap">
          <!-- ä¿¡å°ä¸Šé¢ -->
          <img class="before-img" :src="mainStore.sysConfig['webStaticResourcePrefix'] + 'assets/friendLetterTop.png'" style="width: 100%"/>
          <!-- ä¿¡ -->
          <div class="envelope" style="animation: hideToShow 2s">
            <div class="form-main">
              <div>
                <h3 style="text-align: center">æœ‰æœ‹è‡ªè¿œæ–¹æ¥</h3>
                <div>
                  <div class="myCenter form-friend">
                    <div class="user-title">
                      <div>åç§°ï¼š</div>
                      <div>ç®€ä»‹ï¼š</div>
                      <div>å°é¢ï¼š</div>
                      <div>ç½‘å€ï¼š</div>
                    </div>
                    <div class="user-content">
                      <div>
                        <el-input maxlength="30" v-model="friend.title"></el-input>
                      </div>
                      <div>
                        <el-input maxlength="120" v-model="friend.introduction"></el-input>
                      </div>
                      <div>
                        <el-input maxlength="200" v-model="friend.cover"></el-input>
                      </div>
                      <div>
                        <el-input maxlength="200" v-model="friend.url"></el-input>
                      </div>
                    </div>
                  </div>
                  <div class="myCenter" style="margin-top: 20px">
                    <proButton :info="'æäº¤'"
                               @click.native.stop="submitFriend()"
                               :before="$constant.before_color_2"
                               :after="$constant.after_color_2">
                    </proButton>
                  </div>
                </div>
                <div>
                  <img :src="mainStore.sysConfig['webStaticResourcePrefix'] + 'assets/friendLetterBiLi.png'" style="width: 100%;margin: 5px auto"/>
                </div>
                <p style="font-size: 12px;text-align: center;color: #999">æ¬¢è¿äº¤æ¢å‹é“¾</p>
              </div>
            </div>
          </div>
          <img class="after-img" :src="mainStore.sysConfig['webStaticResourcePrefix'] + 'assets/friendLetterBottom.png'" style="width: 100%"/>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
    import { useMainStore } from '@/stores/main';

const card = () => import( "./common/card");
  const proButton = () => import( "./common/proButton");

  export default {
    components: {
      card,
      proButton
    },

    data() {
      return {
        friendList: {},
        siteInfo: {},
        friend: {
          title: "",
          introduction: "",
          cover: "",
          url: ""
        }
      }
    },

    computed: {
      mainStore() {
        return useMainStore();
      },
      // å…¼å®¹æ—§çš„emoji keyï¼Œç»Ÿä¸€ä½¿ç”¨æ–°emojiè®¿é—®
      eliteFriends() {
        // ä¼˜å…ˆä½¿ç”¨æ–°keyï¼Œå¦‚æœæ²¡æœ‰åˆ™å°è¯•æ—§key
        return this.friendList['ğŸŒŸé’å‡ºäºè“'] || this.friendList['â™¥ï¸é’å‡ºäºè“'] || [];
      },
      regularFriends() {
        return this.friendList['ğŸ¥‡å‹æƒ…é“¾æ¥'] || [];
      }
    },

    watch: {},

    created() {
      this.getFriends();
      this.getSiteInfo();
    },

    mounted() {

    },

    methods: {
      clickLetter() {
        const formWrapElements = document.querySelectorAll('.form-wrap');
        formWrapElements.forEach(element => {
          // ä¿¡å°å±•å¼€åé«˜åº¦å¢åŠ ï¼Œä½†ä¸å‘ä¸Šåç§»ï¼ˆtopä¿æŒä¸º0ï¼‰
          if (document.body.clientWidth < 700) {
            element.style.height = '650px';
          } else {
            element.style.height = '700px';
          }
          
          // è®©ä¿¡å°å†…å®¹å‘ä¸Šç§»åŠ¨
          const envelope = element.querySelector('.envelope');
          if (envelope) {
            envelope.style.transform = 'translateY(-150px)';
          }
        });
      },
      submitFriend() {
        if (this.$common.isEmpty(this.mainStore.currentUser)) {
          // ä½¿ç”¨ç»Ÿä¸€çš„ç™»å½•è·³è½¬å‡½æ•°
          this.$common.redirectToLogin(this.$router, {
            message: 'è¯·å…ˆç™»å½•ï¼'
          }, this);
          return;
        }

        if (this.friend.title.trim() === "") {
          this.$message({
            message: "ä½ è¿˜æ²¡å†™åç§°å‘¢~",
            type: "warning"
          });
          return;
        }

        if (this.friend.introduction.trim() === "") {
          this.$message({
            message: "ä½ è¿˜æ²¡å†™ç®€ä»‹å‘¢~",
            type: "warning"
          });
          return;
        }

        if (this.friend.cover.trim() === "") {
          this.$message({
            message: "ä½ è¿˜æ²¡è®¾ç½®å°é¢å‘¢~",
            type: "warning"
          });
          return;
        }

        if (this.friend.url.trim() === "") {
          this.$message({
            message: "ä½ è¿˜æ²¡å†™ç½‘å€å‘¢~",
            type: "warning"
          });
          return;
        }

        this.$http.post(this.$constant.baseURL + "/webInfo/saveFriend", this.friend)
          .then((res) => {
            const formWrapElements = document.querySelectorAll('.form-wrap');
            formWrapElements.forEach(element => {
              element.style.height = '447px';
              element.style.top = '0';
            });
            this.$message({
              type: 'success',
              message: 'æäº¤æˆåŠŸï¼Œå¾…ç®¡ç†å‘˜å®¡æ ¸ï¼'
            });
          })
          .catch((error) => {
            this.$message({
              message: error.message,
              type: "error"
            });
          });
      },
      clickFriend(path) {
        window.open(path);
      },
      getFriends() {
        this.$http.get(this.$constant.baseURL + "/webInfo/listFriend")
          .then((res) => {
            if (!this.$common.isEmpty(res.data)) {
              this.friendList = res.data;
            }
          })
          .catch((error) => {
            this.$message({
              message: error.message,
              type: "error"
            });
          });
      },
      getSiteInfo() {
        this.$http.get(this.$constant.baseURL + "/webInfo/getSiteInfo")
          .then((res) => {
            if (!this.$common.isEmpty(res.data)) {
              this.siteInfo = res.data;
            }
          })
          .catch((error) => {
            this.$message({
              message: error.message,
              type: "error"
            });
          });
      }
    }
  }
</script>

<style scoped>

  .friend-main {
    max-width: 1200px;
    margin: 40px auto;
    border-radius: 10px;
    padding: 40px;
    background: rgba(255, 255, 255, .85);
  }

  .friend-main h2 {
    font-size: 20px;
  }

  hr {
    position: relative;
    margin: 40px auto;
    border: 2px dashed var(--lightGreen);
    overflow: visible;
  }

  hr:before {
    position: absolute;
    top: -14px;
    left: 5%;
    color: var(--lightGreen);
    content: 'â„';
    font-size: 30px;
    line-height: 1;
    /* æ€§èƒ½ä¼˜åŒ–: æœ‰ç¼©æ”¾åŠ¨ç”»ï¼Œéœ€è¦GPUåŠ é€Ÿ */
    transition: transform 1s ease-in-out, opacity 1s ease-in-out;
    will-change: transform;
    transform: translateZ(0);
  }

  hr:hover:before {
    left: calc(95% - 20px);
  }

  .form-wrap {
    margin: 0 auto;
    overflow: hidden;
    width: 530px;
    height: 447px;
    position: relative;
    top: 0;
    /* æ€§èƒ½ä¼˜åŒ–: é«˜åº¦å˜åŒ–åŠ¨ç”»ï¼Œéœ€è¦GPUåŠ é€Ÿ */
    transition: height 1s ease-in-out;
    z-index: 0;
    cursor: pointer;
    will-change: height;
    transform: translateZ(0);
  }


  .before-img {
    position: absolute;
    bottom: 126px;
    left: 0;
    background-repeat: no-repeat;
    width: 530px;
    height: 317px;
    z-index: -100;
  }

  .after-img {
    position: absolute;
    bottom: -2px;
    left: 0;
    background-repeat: no-repeat;
    width: 530px;
    height: 259px;
    z-index: 100;
  }

  .friend-wrap {
    color: var(--black);
  }

  .envelope {
    position: relative;
    margin: 0 auto;
    /* æ€§èƒ½ä¼˜åŒ–: æœ‰å¤æ‚åŠ¨ç”»ï¼Œéœ€è¦GPUåŠ é€Ÿ */
    transition: transform 1s ease-in-out;
    padding: 200px 20px 20px;
    will-change: transform;
    transform: translateY(0) translateZ(0);
  }

  .form-main {
    background: var(--white);
    margin: 0 auto;
    border-radius: 10px;
    overflow: hidden;
    /* æ·»åŠ é˜´å½±ï¼Œè®©è¡¨å•å’ŒèƒŒæ™¯åŒºåˆ†å¼€ */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
  }


  .user-title {
    text-align: right;
    user-select: none;
  }

  .user-content {
    text-align: left;
  }

  .user-title div {
    height: 55px;
    line-height: 55px;
    text-align: center;
  }

  .user-content > div {
    height: 55px;
    display: flex;
    align-items: center;
  }

  .user-content >>> .el-input__inner {
    border: none;
    height: 35px;
    background: var(--whiteMask);
  }

  .form-friend {
    margin-top: 12px;
    background-color: #eee;
    border: #ddd 1px solid;
    padding: 20px 0;
  }

  /* ç« èŠ‚æ ‡é¢˜ */
  .section-title {
    font-size: 22px;
    font-weight: 600;
    margin: 50px 0 24px 0;
    color: var(--black);
    padding-left: 12px;
    border-left: 4px solid var(--lightGreen);
  }
  
  /* ç”³è¯·æŒ‡å—å®¹å™¨ */
  .application-guide {
    margin-bottom: 50px;
  }
  
  /* ç”³è¯·æ­¥éª¤ */
  .guide-step {
    display: flex;
    align-items: flex-start;
    margin: 24px 0;
  }
  
  .step-number {
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    background: var(--lightGreen);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    margin-right: 16px;
  }
  
  .step-content {
    flex: 1;
  }
  
  .step-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--black);
    margin: 0 0 6px 0;
  }
  
  .step-desc {
    font-size: 14px;
    color: #666;
    margin: 0;
    line-height: 1.6;
  }
  
  /* ç½‘ç«™ä¿¡æ¯å¡ç‰‡ */
  .site-info-box {
    background: #f7f9fc;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0 20px 52px;
  }
  
  .info-item {
    display: flex;
    padding: 12px 0;
    border-bottom: 1px dashed #e1e8ed;
  }
  
  .info-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .info-item:first-child {
    padding-top: 0;
  }
  
  .info-label {
    flex-shrink: 0;
    width: 90px;
    font-size: 14px;
    color: #666;
    font-weight: 500;
  }
  
  .info-value {
    flex: 1;
    font-size: 14px;
    color: #333;
    word-break: break-all;
  }
  
  /* æ¸©é¦¨æç¤ºå¡ç‰‡ */
  .notice-box {
    background: #fffbf0;
    border: 1px solid #ffe7a0;
    border-radius: 8px;
    padding: 20px 24px;
    margin-bottom: 40px;
  }
  
  .notice-header {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
  }
  
  .notice-icon {
    font-size: 22px;
    margin-right: 8px;
  }
  
  .notice-title {
    font-size: 16px;
    font-weight: 600;
    color: #d97706;
  }
  
  .notice-list {
    margin: 0;
    padding-left: 20px;
    list-style: none;
  }
  
  .notice-list li {
    position: relative;
    padding-left: 16px;
    margin: 10px 0;
    font-size: 14px;
    color: #666;
    line-height: 1.6;
  }
  
  .notice-list li:before {
    content: 'â€¢';
    position: absolute;
    left: 0;
    color: #f59e0b;
    font-weight: bold;
  }

  @media screen and (max-width: 700px) {
    .form-wrap {
      width: auto;
    }

    .before-img {
      width: auto;
    }

    .after-img {
      width: auto;
    }
    
    .site-info-box {
      margin-left: 0;
    }
    
    .info-item {
      flex-direction: column;
    }
    
    .info-label {
      margin-bottom: 4px;
      color: #999;
    }
  }

  @media screen and (max-width: 500px) {
    .friend-main {
      padding: 40px 15px;
    }
    
    .section-title {
      font-size: 20px;
      margin-top: 40px;
    }
    
    .step-number {
      width: 32px;
      height: 32px;
      font-size: 16px;
      margin-right: 12px;
    }
    
    .step-title {
      font-size: 15px;
    }
    
    .step-desc {
      font-size: 13px;
    }
    
    .site-info-box {
      padding: 16px;
    }
    
    .notice-box {
      padding: 16px 20px;
    }
  }
</style>
